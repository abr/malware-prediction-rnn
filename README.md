# malware-prediction-rnn
RNN implementation in Keras to predict malware from machine activity data
Code for experiments in [*Early Stage Malware Prediction Using Recurrent Neural Networks*](https://arxiv.org/abs/1708.03513)

Experiments from the paper are set out in order in run_experiments 

Implementation uses [Keras v2.0.6](https://github.com/fchollet/keras/releases/tag/2.0.6) 

## Experiment
The basic Experiment class in *experiments > Experiments* takes a dictionary of hyperparameters and data as objects (either as a tuple for k-fold cross validation or as four separate test/train inputs/labels items). Results are stored in a [folder](#folder) as a comma separated values file.  

* **parameters:** A dictionary of hyperparamters such as in *experiments > Configs*. 

The keys relate to the RNN implementation and the values can either be a list or a dictionary of possible values with associated weighted probabilities of choosing them. The latter is intended to aid biased random searches e.g. params = {.... \["dropout"\] = {0.2: 0.5, 0.1: 0.25, 0.3: 0.25}.... } will bias the random search to choose a value of 0.2 half of the time, and 0.1 or 0.3 respectively quarter of the time.

* **search_algorithm:** {"grid", "random"}

**Grid search** will explore every possible combination of parameters supplied to the Experiment. Grid search will keep running until all options have been exhausted
**Random search** will randomly select a configuration from the possible combinations of parameters, the choice of parameters can be biased by using dictionaries with values representing relative weights between the keys. See [Configurations / RNN hyperparameters](#configs) for more. Random search will run until the num_experiments parameter in Experiment.run() is reached, default=100.

* **x_train:** sequential (3D) tensor of train input data supplied for a train-test experiment
* **y_train:** sequential (2D) tensor of train label data supplied for a train-test experiment, corresponding to the indicies of the x_train data 
* **x_test:** sequential (3D) tensor of test input data supplied for a train-test experiment
* **y_test:** sequential (2D) tensor of test label data supplied for a train-test experiment, corresponding to the indicies
of the x_test data 
* <a name="data"></a>**data**: tuple of (input, label) data for k-fold cross validation experiment 
* **folds**: integer to determine k in k-fold validation, defaults to 10. Must be an integer (or left default) for k-fold validation experiment along with [data tuple](#data)
* **thresholding**: Boolean to determine if k-fold test is cut short when accuracy falls below [threshold](#threshold), defaults to False.
When thresholding=True, the threshold automatically increases if the average accuracy of k-folds is greater than the threshold. The new threshold is minimum of the set of k-fold accuracies.
* <a name="threshold"></a>**threshold**: 0 <= float < 1 which determines accuracy level cut off during a k-fold experiment. If a fold acheives lower than *threshold*, the remaining folds are not run, and the next configuration will begin. Automatically increases if a k-fold experiment achieved higher average accuracy (across k-folds) than threshold to the minimum of the set of k-fold accuracies. 
* <a name="folder"></a>**folder_name**: String to name folder in which csv file results are stored 

### Increase_Snaphot_Experiment

Increase the temporal distance between input features.
Add "steps" to parameters dictionary to increase the time interval between data, should be integer <= sequence_length

### Ensemble_configurations

Average the results of multiple RNN models.Experiment will only search sequence_length space, and will take the first value provided for all other hyperparameters if more than one is supplied
* Pass a list of parameter dictionaries in place of *parameters* to *Ensemble_configurations* class to average the results of multiple models. Only the first element in the list of possible parameters will be used if more than one is supplied. 
* **batch_size:** int can be passed to *Ensemble_configurations* to use the same batch_size across models

### Ensemble_sub_sequences

Average the results of classifying all sub-sequences and the entire data sequence. Experiment will only search sequence_length space, and will take the first value provided for all other hyperparameters if more than one is supplied

### Omit_test_data

Leave all possible combinations of input features out of training to see impact of their omission. Trains a model then sequentially omits all possible combinations of 1,2,3...n, where n=total number of features, giving 2047 combinations for the 11 features used in the paper.

### Omit training data

Leave a single feature out of testing and training.
* supply "leave_out_features" to parameters dictionary to omit a single feature from training and testing

## RNN implementation

Takes a dictionary of parameters, the training data and testing data as input. Data used to determine shape of RNN layers. Possible options for configurations outlined in [Configurations / RNN hyperparameters](#configs).


## <a name="configs"></a>Configurations / RNN hyperparameters
